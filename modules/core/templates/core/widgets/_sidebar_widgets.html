{% block nav_item %}
    {#  Renders a single navigation item (<li>) with:                                                   #}
    {#      • label (string)  – the text displayed in the menu                                          #}
    {#      • href  (string)  – the target URL (use {% url ... as var %} or pass a string)              #}
    {#      • icon  (string)  – the FontAwesome icon class (e.g. "fas fa-home")                         #}
    {#                                                                                                  #}
    {#      Example:                                                                                    #}
    {#         {% widget "widgets:nav_item" label="Dashboard" href=demo_url icon="fas fa-th-large" %}   #}

    <li>
        <a href="{{ href }}"
           class="flex items-center gap-3 p-3 hover:bg-gray-100 rounded-lg transition-colors duration-200"
           :class="{ 'justify-center': shouldCenter }"
        >
            {% icons icon %}
            <span x-show="sidebarExpanded || sidebarOpen"
                  x-transition:enter="transition-all ease-out duration-200 delay-75"
                  x-transition:enter-start="opacity-0 -translate-x-2"
                  x-transition:enter-end="opacity-100 translate-x-0"
                  x-transition:leave="transition-all ease-in duration-150"
                  x-transition:leave-start="opacity-100 translate-x-0"
                  x-transition:leave-end="opacity-0 -translate-x-2"
                  class="whitespace-nowrap"
            >
                {{ label }}
            </span>
        </a>
    </li>
{% endblock %}

{% block nav_item_with_subnav %}
    {#  Renders a navigation item (<li>) with a submenu, with:                                          #}
    {#      • label (string)       – the text displayed in the menu                                     #}
    {#      • icon  (string)       – the FontAwesome icon class (e.g. "fas fa-home")                    #}
    {#      • submenu_items (dict) – a list of strings representing submenu item labels                 #}
    {#                               Example:                                                           #}
    {#                                  {[Label Name]: [url]}                                           #}
    {#                                                                                                  #}
    {#      Example:                                                                                    #}
    {#         {% widget "widgets:nav_item_with_subnav"                                                 #}
    {#                    label="Workspace"                                                             #}
    {#                    icon="briefcase"                                                       #}
    {#                    submenu_items="{'Example': 'url as variable'}"|to_dict %}                                                 #}

    <li class="relative" x-data="{ buttonRect: null, submenuItems: {{ submenu_items|safe }} }">
        <button class="flex items-center gap-3 p-3 hover:bg-gray-100 rounded-lg transition-colors duration-200 w-full"
                :class="{
                    'bg-gray-50': openMenu === '{{ label }}',
                    'justify-center': shouldCenter
                }"
                @click="
                    openMenu = openMenu === '{{ label }}' ? null : '{{ label }}';
                    buttonRect = $el.getBoundingClientRect()
                "
                @mouseenter.self="
                    if (!sidebarExpanded) {
                        if (window.matchMedia('(hover: hover)').matches) {
                            openMenu = '{{ label }}';
                            buttonRect = $el.getBoundingClientRect()
                        }
                    }
                "
                @mouseleave.self="
                    if (!sidebarExpanded) {
                        if (window.matchMedia('(hover: hover)').matches) {
                            openMenu = null
                        }
                    }"
        >
            {% icons icon %}
            <span x-show="sidebarExpanded || sidebarOpen"
                  x-transition:enter="transition-all ease-out duration-200 delay-150"
                  x-transition:enter-start="opacity-0 -translate-x-2"
                  x-transition:enter-end="opacity-100 translate-x-0"
                  x-transition:leave="transition-all ease-in duration-150"
                  x-transition:leave-start="opacity-100 translate-x-0"
                  x-transition:leave-end="opacity-0 -translate-x-2"
                  class="whitespace-nowrap flex-1 text-left"
            >
                {{ label }}
            </span>
            <svg x-show="sidebarExpanded || sidebarOpen"
                 class="w-4 h-4 text-gray-400 transition-transform duration-200"
                 :class="{ 'rotate-180': openMenu === '{{ label }}' }"
                 fill="none"
                 stroke="currentColor"
                 viewBox="0 0 24 24"
            >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
        </button>

        <div x-show="openMenu === '{{ label }}'"
             x-transition:enter="transition-all ease-out duration-200"
             x-transition:enter-start="opacity-0 translate-y-2"
             x-transition:enter-end="opacity-100 translate-y-0"
             x-transition:leave="transition-all ease-in duration-150"
             x-transition:leave-start="opacity-100 translate-y-0"
             x-transition:leave-end="opacity-0 translate-y-2"
             class="fixed bg-white border border-gray-200 rounded-lg shadow-lg overflow-hidden z-[60]"
             :style="{
                top: (sidebarExpanded || sidebarOpen) ? (buttonRect?.bottom + 4) + 'px' : buttonRect?.top + 'px',
                left: (sidebarExpanded || sidebarOpen) ? buttonRect?.left + 'px' : (buttonRect?.right + 8) + 'px',
                width: (sidebarExpanded || sidebarOpen) ? buttonRect?.width + 'px' : '224px'
             }"
             @mouseenter="
                if (window.matchMedia('(hover: hover)').matches) {
                    openMenu = '{{ label }}'
                }"
             @mouseleave="
                if (!sidebarExpanded){
                    if (window.matchMedia('(hover: hover)').matches) {
                        openMenu = null
                    }
                }"
             @click.outside="openMenu = null"
        >
            <template x-for="(href, label) in submenuItems" :key="label">
                <a class="flex items-center gap-3 px-4 py-3 hover:bg-gray-50 transition-colors duration-200"
                   :href="href"
                   x-text="label"></a>
            </template>
        </div>
    </li>
{% endblock %}
